# invideo-terraform-assignment

Terraform configuration files to provision the infrastructure for the InVideo assignment.

**Overview of the Infra Created**

- VPC with two public subnets (for EKS), four private subnets (for EKS & RDS), a NAT Gateway, an internet gateway and required route tables.
- EKS cluster with nodes in private subnet and load balancer in public subnet.
- RDS PostgreSQL instance in private subnet.

**PREREQUISITES**

- AWS CLI must be installed and configured with a profile having relevant IAM Permissions (preferably admin)
- Terraform must be installed
- `kubectl` must be installed

**Steps to Run**

1. Replace the `variables.tf ` file values with relevant values (at the root level as well as inside the modules, wherever relevant)
2. Create a `terraform.tfvars` file at the root level with the values for `db_username` and `db_password` for the PostgreSQL database.
3. Initialize the Terraform environment :
   `terraform init`
4. Validate the Terraform configuration :
   `terraform validate`
5. Apply the Terraform configuration :
   `terraform apply --auto-approve`
6. On successful completion of the above steps, the infrastructure will be created. Now we need to update the kubeconfig file with the credentials for the EKS cluster. We can do this by running the following command :
   `aws eks --region <region> update-kubeconfig --name <eks-cluster-name>`
7. Now we can deploy the necessary kuberenetes manifests for the InVideo assignment. We can do this by running the following commands :

   `cd k8s-config`
   `kubectl apply -f deployment.yml` ---> Deployment containing nginx pod configs
   `kubectl apply -f service.yml` ---> Service containing load balancer configs
   `kubectl apply -f nginx-config.yml` ---> ConfigMap containing config to return random text

8. Once the configurations are applied, we can get the url of the loadbalancer by running the following command :
   `kubectl get svc`

9. Visit the loadbalancer URL to see the random text generated by the nginx pod.

10. To destroy the infrastructure, run the following command :
    `terraform destroy --auto-approve`
